<!doctype html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="undefined">
  <meta name="description" content="互联网技术">
  <meta name="author" content="zhangyu">

  
  <title>学会备份MySQL数据库</title>
  

  <link rel="canonical" href="http://zhangyu8.me/2016/08/20/258/index.html">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="undefined">
  <link rel="stylesheet" href="/font.css">
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang"></i><a href="/index.html" class="aside-menu-link" title="首页">首页</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang1"></i><a href="/archives/index.html" class="aside-menu-link" title="所有文章">所有文章</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-biaoqian1"></i><a href="/tags/index.html" class="aside-menu-link" title="分类标签">分类标签</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-lianjie"></i><a href="/links/index.html" class="aside-menu-link" title="友情链接">友情链接</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-guanyu"></i><a href="/about/index.html" class="aside-menu-link" title="关于">关于</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.png" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          大雨哥
          
          <strong class="aside-avatar-STRONG">个人博客</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">互联网技术/架构/团队</p>
    </div>
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">学会备份MySQL数据库</h1>
    <p class="post-meta">
      <span class="post-time">2016-08-20</span>
      
      <a href="/categories/mysql/" title="mysql" class="post-categories">mysql</a>
      
      
      <a href="/tags/mysql/" " title="mysql" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>mysql</a>
      
      <a href="/tags/备份/" " title="备份" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>备份</a>
      
    </p>
    
  </header>
  <div class="post-content"><p>###<br>    简单方案</p>
<div style="text-align: left; color: rgb(0, 0, 0); text-transform: none; line-height: 21px; text-indent: 0px; letter-spacing: normal; font-family: 微软雅黑; font-size: 14px; font-variant: normal; font-weight: normal; word-spacing: 0px; white-space: normal; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;"><br><br>        方案一：<br><br>        <span style="background-color: inherit;">前提是：</span><br><br>        <span style="background-color: inherit;">1</span><span style="background-color: inherit;">系统权限/路径统一。</span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">2停止应用连接</span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">3<span style="background-color: inherit;">执行以下 SQL 语句： flush tables with read lock; &nbsp;</span></span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;"><span style="background-color: inherit;">也就是把内存中的数据都刷新到磁盘中，同时锁定数据表，<span style="background-color: inherit;">为了保证数据的一致性.<span style="text-align: left; color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-weight: normal; background-color: rgb(255, 255, 255);">，防止导出数据库的时候有数据写入</span></span></span></span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">4最好关闭mysql服务。</span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;"><span style="background-color: inherit;">5需要备份其日志文件，即 ib_logfile* 文件。</span></span></span><br><br>        <span style="background-color: inherit;">&nbsp;通过文件形式复制保存，备份，恢复只要复制到相应文件目录即可，无需使用其它工具备份。</span><br><br>        <span style="background-color: inherit;">完成后，在启动mysql服务。</span><br><br>        &nbsp;<br><br>        <span style="background-color: inherit;"><span style="background-color: inherit;"><span style="background-color: inherit;">方案二：</span></span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;"><span style="background-color: inherit;"><span style="background-color: inherit;">导出<span style="background-color: inherit;">是：</span></span></span></span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">mysqldump [OPTIONS] database [tables]</span></span><br><br>        <span style="background-color: inherit;">　　如果你不给定任何表，整个数据库将被导出。</span><br><br>        比如<br><br>        mysqldump -u root -p –default-character-set=utf8 –opt -Q -R –skip-lock-tables mysqldb &gt; /home/mysqldbbak.sql &nbsp;<br><br>        <span style="background-color: inherit;">　　注意，如果你运行<span lang="EN-US" style="background-color: inherit;">mysqldump</span>没有<span lang="EN-US" style="background-color: inherit;">–quick</span>或<span lang="EN-US" style="background-color: inherit;">–opt</span>选项，<span lang="EN-US" style="background-color: inherit;">mysqldump</span>将在导出结果前装载整个结果集到内存中，如果你正在导出一个大的数据库，这将可能是一个问题。</span><br><br>        <span style="background-color: inherit;">导入</span>是：<br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">mysqladmin create target_db_name</span></span><br><br>        <span style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">mysql target_db_name &lt;/home/mysqldbbak.sql &nbsp;</span></span><br><br></div>

<p>###<br>    为什么需要备份数据？</p>
<blockquote>
<p><span style="line-height: 1.5; font-size: 1em; background-color: rgb(255, 255, 255);">在生产环境中我们数据库可能会遭遇各种各样的不测从而导致数据丢失, 大概分为以下几种.</span></p>
<ul>
<li>硬件故障</li>
</ul>
<ul>
<li>软件故障</li>
</ul>
<ul>
<li>自然灾害</li>
</ul>
<ul>
<li>黑客攻击</li>
</ul>
<ul>
<li>误操作 (占比最大)</li>
</ul>
<pre><code>所以, 为了在数据丢失之后能够恢复数据, 我们就需要定期的备份数据, 备份数据的策略要根据不同的应用场景进行定制, 大致有几个参考数值, 我们可以根据这些数值从而定制符合特定环境中的数据备份策略
</code></pre><ul>
<li>能够容忍丢失多少数据</li>
</ul>
<ul>
<li>恢复数据需要多长时间</li>
</ul>
<ul>
<li>需要恢复哪一些数据</li>
</ul>
</blockquote>
<p>###<br>    数据的备份类型</p>
<blockquote>
<p>数据的备份类型根据其自身的特性主要分为以下几组</p>
<ul>
<li>完全备份</li>
</ul>
<ul>
<li>部分备份</li>
</ul>
<pre><code>        完全备份指的是**备份整个数据集( 即整个数据库 )**、部分备份指的是**备份部分数据集(例如: 只备份一个表)**


而部分备份又分为以下两种
</code></pre><ul>
<li>增量备份</li>
</ul>
<ul>
<li>差异备份</li>
</ul>
<pre><code>        增量备份指的是**备份自上一次备份以来(增量或完全)以来变化的数据**; 特点: 节约空间、还原麻烦

        差异备份指的是**备份自上一次完全备份以来变化的数据** 特点: 浪费空间、还原比增量备份简单


&amp;nbsp;
</code></pre></blockquote>
<p>###<br>    MySQL备份数据的方式</p>
<blockquote>
<p>在<code>&lt;font size=&quot;3&quot;&gt;MySQl&lt;/font&gt;</code>中我们备份数据一般有几种方式</p>
<ul>
<li>热备份</li>
</ul>
<ul>
<li>温备份</li>
</ul>
<ul>
<li>冷备份</li>
</ul>
<pre><code>        热备份指的是当数据库进行备份时, **数据库的读写操作均不是受影响 **

        温备份指的是当数据库进行备份时, **数据库的读操作可以执行, 但是不能执行写操作**

        冷备份指的是当数据库进行备份时, **数据库不能进行读写操作, 即数据库要下线**


`&lt;font size=&quot;3&quot;&gt;MySQL&lt;/font&gt;`中进行不同方式的备份还要考虑存储引擎是否支持
</code></pre><ul>
<li>MyISAM</li>
</ul>
<ul>
<li style="list-style: none"><input type="checkbox"> 热备</li>
</ul>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 温备</li>
</ul>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 冷备</li>
</ul>
<ul>
<li>InnoDB</li>
</ul>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 热备</li>
</ul>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 温备</li>
</ul>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 冷备</li>
</ul>
<pre><code>我们在考虑完数据在备份时, 数据库的运行状态之后还需要考虑对于`&lt;font size=&quot;3&quot;&gt;MySQL&lt;/font&gt;`数据库中数据的备份方式
</code></pre><ul>
<li>物理备份</li>
</ul>
<ul>
<li>逻辑备份</li>
</ul>
<pre><code>物理备份一般就是**通过`&lt;font size=&quot;3&quot;&gt;tar&lt;/font&gt;`,`&lt;font size=&quot;3&quot;&gt;cp&lt;/font&gt;`等命令直接打包复制数据库的数据文件**达到备份的效果

逻辑备份一般就是**通过特定工具从数据库中导出数据并另存备份**(逻辑备份会丢失数据精度)
</code></pre></blockquote>
<p>###<br>    备份需要考虑的问题</p>
<blockquote>
<p>定制备份策略前, 我们还需要考虑一些问题</p>
<pre><code>**我们要备份什么?**


一般情况下, 我们需要备份的数据分为以下几种
</code></pre><ul>
<li>数据</li>
</ul>
<ul>
<li>二进制日志, InnoDB事务日志</li>
</ul>
<ul>
<li>代码(存储过程、存储函数、触发器、事件调度器)</li>
</ul>
<ul>
<li>服务器配置文件</li>
</ul>
<pre><code>**备份工具**


&lt;font size=&quot;3&quot; style=&quot;background-color: inherit;&quot;&gt;这里我们列举出常用的几种备份工具

`mysqldump` : 逻辑备份工具, 适用于所有的存储引擎, 支持温备、完全备份、部分备份、对于**InnoDB**存储引擎支持热备

`cp, tar 等归档复制工具`: &amp;nbsp;物理备份工具, 适用于所有的存储引擎, 冷备、完全备份、部分备份

`lvm2 snapshot`: 几乎热备, 借助文件系统管理工具进行备份

`mysqlhotcopy`: 名不副实的的一个工具, 几乎冷备, 仅支持**MyISAM**存储引擎

`xtrabackup`: 一款非常强大的**InnoDB/XtraDB**热备工具, &amp;nbsp;支持完全备份、增量备份, 由`percona`提供&lt;/font&gt;
</code></pre></blockquote>
<p>###<br>    设计合适的备份策略</p>
<blockquote>
<p>针对不同的场景下, 我们应该制定不同的备份策略对数据库进行备份, 一般情况下, 备份策略一般为以下三种</p>
<ul>
<li><strong>直接cp,tar复制数据库文件</strong></li>
</ul>
<ul>
<li><strong>mysqldump+复制BIN LOGS</strong></li>
</ul>
<ul>
<li><strong>lvm2快照+复制BIN LOGS</strong></li>
</ul>
<ul>
<li><strong>xtrabackup</strong></li>
</ul>
<pre><code>以上的几种解决方案分别针对于不同的场景
</code></pre><ol>
<li>如果数据量较小, 可以使用第一种方式, 直接复制数据库文件</li>
</ol>
<ol start="2">
<li>如果数据量还行, 可以使用第二种方式, 先使用mysqldump对数据库进行完全备份, 然后定期备份BINARY LOG达到增量备份的效果</li>
</ol>
<ol start="3">
<li>如果数据量一般, 而又不过分影响业务运行, 可以使用第三种方式, 使用<code>&lt;font size=&quot;3&quot;&gt;lvm2&lt;/font&gt;</code>的快照对数据文件进行备份, 而后定期备份BINARY LOG达到增量备份的效果</li>
</ol>
<ol start="4">
<li>如果数据量很大, 而又不过分影响业务运行, 可以使用第四种方式, 使用<code>&lt;font size=&quot;3&quot;&gt;xtrabackup&lt;/font&gt;</code>进行完全备份后, 定期使用<code>&lt;font size=&quot;3&quot;&gt;xtrabackup&lt;/font&gt;</code>进行增量备份或差异备份</li>
</ol>
</blockquote>
<p>###<br>    总结</p>
<table border="1" cellpadding="2" cellspacing="0" style="color: rgb(62, 62, 62); text-transform: none; text-indent: 0px; letter-spacing: normal; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-size: 16px; margin-top: 10px; margin-bottom: 10px; word-spacing: 0px; display: table; border-collapse: collapse; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;"><br>    <thead style="background-color: inherit;"><br>        <tr style="background-color: white;"><br>            <th style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: rgb(240, 240, 240);"><br>                备份方法<br>            </th><br>            <th style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: right; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: rgb(240, 240, 240);"><br>                备份速度<br>            </th><br>            <th style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: center; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: rgb(240, 240, 240);"><br>                恢复速度<br>            </th><br>            <th style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: rgb(240, 240, 240);"><br>                便捷性<br>            </th><br>            <th style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: rgb(240, 240, 240);"><br>                功能<br>            </th><br>            <th style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: rgb(240, 240, 240);"><br>                一般用于<br>            </th><br>        </tr><br>    </thead><br>    <tbody style="background-color: inherit;"><br>        <tr style="background-color: white;"><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                cp<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: right; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: center; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                一般、灵活性低<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                很弱<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                少量数据备份<br>            </td><br>        </tr><br>        <tr style="background-color: rgb(248, 248, 248);"><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                mysqldump<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: right; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                慢<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: center; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                慢<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                一般、可无视存储引擎的差异<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                一般<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                中小型数据量的备份<br>            </td><br>        </tr><br>        <tr style="background-color: white;"><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                lvm2快照<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: right; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: center; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                一般、支持几乎热备、速度快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                一般<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                中小型数据量的备份<br>            </td><br>        </tr><br>        <tr style="background-color: rgb(248, 248, 248);"><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                xtrabackup<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: right; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                较快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; text-align: center; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                较快<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                实现innodb热备、对存储引擎有要求<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                强大<br>            </td><br>            <td style="padding: 5px 16px 5px 12px; border: 1px solid rgb(153, 153, 153); border-image: none; height: 25px; font-size: 1em; -ms-word-break: break-all; min-height: 25px; min-width: 25px; background-color: inherit;"><br>                较大规模的备份<br>            </td><br>        </tr><br>    </tbody><br></table></div>
    
      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            
          </div>
        </div>
      </div>
    
  
</article>

      <footer class="footer">
  <p class="footer-text"></p>
</footer>

    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
