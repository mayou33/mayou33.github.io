<!doctype html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="undefined">
  <meta name="description" content="互联网技术">
  <meta name="author" content="zhangyu">

  
  <title>论版本号的正确打开方式</title>
  

  <link rel="canonical" href="http://zhangyu8.me/2016/10/11/549/index.html">
  <link rel="shortcut icon" href="/">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="undefined">
  <link rel="stylesheet" href="/font.css">
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang"></i><a href="/index.html" class="aside-menu-link" title="首页">首页</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang1"></i><a href="/archives/index.html" class="aside-menu-link" title="所有文章">所有文章</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-biaoqian1"></i><a href="/tags/index.html" class="aside-menu-link" title="分类标签">分类标签</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-lianjie"></i><a href="/links/index.html" class="aside-menu-link" title="友情链接">友情链接</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-guanyu"></i><a href="/about/index.html" class="aside-menu-link" title="关于">关于</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
      <form class="search-from" id="search-from">
  <input class="search-text" id="search-text" type="text" name="searchText" value autocomplete="off">
  <button class="search-btn" id="search-btn" type="button"><i class="search-btn-icon iconfont icon-sousuo-sousuo"></i></button>
</form>

      <article class="search-data" id="search-data">
  <button class="search-close" id="search-close"><i class="search-close-icon iconfont icon-houdongfangiconfont10"></i></button>

  <div class="search-wrapper" id="search-wrapper"></div>
</article>

    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.png" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          大雨哥
          
          <strong class="aside-avatar-STRONG">个人博客</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">互联网技术/架构/团队</p>
    </div>
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">论版本号的正确打开方式</h1>
    <p class="post-meta">
      <span class="post-time">2016-10-11</span>
      
      <a href="/categories/Management/" title="管理" class="post-categories">管理</a>
      
      
      <a href="/tags/管理/" " title="管理" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>管理</a>
      
    </p>
    
  </header>
  <div class="post-content"><p>版本号广泛运用于开发的各种场景：NPM 包的版本定义、对 NPM 包的特定版本的依赖指定、git 的 daily 版本号分支&hellip;&hellip;</p>
<pre><code>面对如此多的场景，版本号的命名却存在很大问题。举些例子：
</code></pre><ul>
<li>开始写一个新项目 / 模块时，不管三七二十一，都从 <code>0.0.1</code> 起版本，直到项目不再维护时，版本还停留在 <code>0.0.48</code>，前两位永远都是 0。</li>
<li>API 变化巨大，而版本号雷打不动一步一个脚印。一个二方包从 <code>0.0.8</code> 升级到 <code>0.0.9</code> 就引起了整个项目的崩溃。</li>
<li>依赖二方 / 三方包时，不知道该依赖哪个版本，有时随便指定了一个，有时则直接依赖了 <code>*</code>。</li>
</ul>
<hr>
<p>##<br>    版本号的命名</p>
<p>###<br>    SemVer</p>
<pre><code>根据国际主流的惯例，我们使用「语义化版本（[&lt;font color=&quot;#0066cc&quot;&gt;Semantic Versioning&lt;/font&gt;](http://semver.org/)）」的命名方式，有时简称 SemVer。

语义化版本号（以下简称「版本号」）的格式是：`&amp;lt;major&amp;gt;.&amp;lt;minor&amp;gt;.&amp;lt;patch&amp;gt;`。即使用三位非负整数，以点号 `.` 连接。

如：`1.4.15`、`6.2.0`。
</code></pre><p>###<br>    每一位版本号的含义</p>
<ol>
<li><code>&amp;lt;major&amp;gt;</code> 即主版本号，俗称大版本升级。改动到主版本号时，标志着 API 发生了巨大变化，包括但不限于新增特性、修改机制、删除功能， <strong>一般不兼容上一个主版本号</strong>。</li>
<li><code>&amp;lt;minor&amp;gt;</code> 即次版本号，俗称小版本升级。当我们进行常规的新增或修改功能时，改动次版本号，但是 <strong>必须是向前兼容的</strong>。这也意味着我们 <strong>不能直接删除某个功能</strong>。如若必要，我们可以在 <a href="http://guide.taobao.net/6.changelog.php" target="_blank" rel="noopener"><font color="#0066cc">changelog</font></a> 中标记某项功能为「即将删除（Deprecated）」，然后在下一个大版本中将其彻底删除。</li>
<li><p><code>&amp;lt;patch&amp;gt;</code> 即修订号，俗称 bug 修复。顾名思义，如果仅仅为了修复或调整一些小问题，我们就只改动修订号。</p>
<p>所以，当我们明确了每一位的含义和作用后，就不会陷入「每次只改最末位」的尴尬中了。</p>
<p>那如何判断一个修改应该是改动修订号还是次版本号呢？视情况而定。比如对于「修改了 app 图标」这件事来说，如果只是调整了图标的间距位置，那么可以认作问题修复；如果把整个图标换了，配上了不同的标语，那么这应该是一次功能改动。</p>
</li>
</ol>
<p>###<br>    注意事项</p>
<ul>
<li>版本号前不要加 <code>v</code>。</li>
<li>不要在数字前补 <code>0</code>。错误示例：<code>01.12.03</code>。</li>
<li>每一位版本号按照 +1 的速度递增，不要在版本号之间跳跃。</li>
<li>主版本号停留在 <code>0</code> 的版本号，即 <code>0.x.x</code> 应当视作还在内部开发阶段的代码。如果代码有公共 API，此时不宜对外公开。</li>
<li><code>1.0.0</code> 的版本号用于界定公共 API 的形成。</li>
<li>当次版本号递增时，修订号归零；当主版本号递增时，次版本号、修订号归零。</li>
<li>进行新的开发时，版本号从 <code>0.1.0</code> 开始。</li>
<li>如果不小心把一个不兼容的改版当成了次版本号发行，应当发行一个新的次版本号来更正这个问题并且恢复向下兼容。注意 <strong>不能去修改已发行的版本</strong>。</li>
</ul>
<p>###<br>    一个典型的版本号发展示例</p>
<ol>
<li><code>0.1.0</code></li>
<li><code>0.1.1</code></li>
<li><code>0.1.2</code></li>
<li><code>0.2.0</code></li>
<li><code>1.0.0</code></li>
<li><code>1.1.0</code></li>
<li><code>1.1.1</code></li>
<li>&hellip;&hellip;</li>
</ol>
<p>###<br>    快速修改版本号</p>
<pre><code>如果一个包发布在 NPM / TNPM 中，可以快速修改其版本号。会自动触发一个 git 提交。
</code></pre><figure class="highlight plain"><br>    <table><br>        <tbody><br>            <tr><br>                <td class="gutter"><br>                    <pre><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre><br>                </td><br>                <td class="code"><br>                    <pre><br><span class="line"># 递增一个修订号</span><br><span class="line">npm version patch</span><br><br><span class="line"># 递增一个次版本号</span><br><span class="line">npm version minor</span><br><br><span class="line"># 递增一个主版本号</span><br><span class="line">npm version major</span><br></pre><br>                </td><br>            </tr><br>        </tbody><br>    </table><br></figure>

<p>##<br>    预发版本号</p>
<pre><code>在常规的版本号命名之上还有一个特殊类别，叫做预发版本号（prerelease version）。它表示当前版本是一个不稳定的版本，使用它时需要注意风险。

预发版本号的格式是 `&amp;lt;major&amp;gt;.&amp;lt;minor&amp;gt;.&amp;lt;patch&amp;gt;-&amp;lt;tag&amp;gt;`，即前半部分和常规版本号相同，然后跟上连接符 `-`，后面再跟上字母数字点号连接符（[0-9A-Za-z-.]）。

一个典型的预发版本号形如 `1.0.0-beta.1`。建议使用这种 `&amp;lt;major&amp;gt;.&amp;lt;minor&amp;gt;.&amp;lt;patch&amp;gt;-&amp;lt;stage&amp;gt;.&amp;lt;num&amp;gt;` 的形式。其中 `&amp;lt;stage&amp;gt;` 一般选用：`alpha`、`beta`、`rc`。

预发版本号是常规版本号的附属，因此在版本的大小比较上，仍然先比较常规版本号部分；对于预发标记部分的比较，则是根据 ASCII 字母表中的顺序来进行。
</code></pre><p>###<br>    一个典型的预发版本号发展示例</p>
<ol>
<li><code>0.9.0</code></li>
<li><code>1.0.0-alpha.1</code></li>
<li><code>1.0.0-alpha.2</code></li>
<li><code>1.0.0-beta.1</code></li>
<li><code>1.0.0-rc.1</code></li>
<li><code>1.0.0</code></li>
<li><code>1.0.1</code></li>
<li>&hellip;&hellip;</li>
</ol>
<p>##<br>    依赖的版本号标记法</p>
<pre><code>我们广泛使用的 NPM 本身也遵从 SemVer 版本号命名，除了包版本本身的定义之外，最重要的是对三方包依赖的版本号的定义，不当的写法将导致一系列潜在的问题。
</code></pre><p>###<br>    指定可用的版本号范围</p>
<pre><code>在 NPM 包的 deps 系列字段中，经常出现形如 `~1.0.4`、`^2.1.1` 这样的标记法，这种标记法标记的是「版本号范围（version range）」，它表示依赖的三方包其版本号只要落在定义版本号范围内，即算合法。另外，当运行 `npm update` 时，依赖的包将升级到版本号范围支持的最高版本。

版本号范围的标记符号有很多种，诸如比较符号 `&amp;gt;=`、`&amp;lt;` 等；连接符 `-`；通配符 `x`、`*`；模糊符 `^`、`~`。具体的用法可参考 [&lt;font color=&quot;#0066cc&quot;&gt;NPM 官方文档&lt;/font&gt;](https://docs.npmjs.com/misc/semver)，这里仅给出常用的标记方式。
</code></pre><div style="-ms-overflow-x: auto;"><br>    <table><br>        <thead><br>            <tr><br>                <th><br>                    含义<br>                </th><br>                <th><br>                    最简写法<br>                </th><br>                <th><br>                    使用通配符的写法<br>                </th><br>                <th><br>                    使用模糊符的写法<br>                </th><br>                <th><br>                    表达的版本号范围<br>                </th><br>            </tr><br>        </thead><br>        <tbody><br>            <tr><br>                <td><br>                    仅跟进修复版本<br>                </td><br>                <td><br>                    <code>1.0</code><br>                </td><br>                <td><br>                    <code>1.0.x</code><br>                </td><br>                <td><br>                    <code>~1.0.4</code><br>                </td><br>                <td><br>                    <code>&amp;gt;=1.0.4 &amp;lt;1.1.0</code><br>                </td><br>            </tr><br>            <tr><br>                <td><br>                    跟进每个小版本更新<br>                </td><br>                <td><br>                    <code>1</code><br>                </td><br>                <td><br>                    <code>1.x</code>、<code>1.x.x</code><br>                </td><br>                <td><br>                    <code>^1.0.4</code><br>                </td><br>                <td><br>                    <code>&amp;gt;=1.0.4 &amp;lt;2.0.0</code><br>                </td><br>            </tr><br>            <tr><br>                <td><br>                    始终升级到最新版<br>                </td><br>                <td><br>                    <code>*</code><br>                </td><br>                <td><br>                    <code>*</code><br>                </td><br>                <td><br>                    <code>*</code><br>                </td><br>                <td><br>                    <code>&amp;gt;=0.0.0</code><br>                </td><br>            </tr><br>        </tbody><br>    </table><br></div>

<pre><code>我们建议在写法上采用 **「使用通配符的写法」**，并且一般情况下 **「跟进每个小版本更新」**，但 **不「始终升级到最新版」**，即书写为 `1.x`。由于 `&amp;lt;major&amp;gt;` 位版本是不向下兼容的，所以在大版本的控制上，仍然采用人为干预以保证安全。
</code></pre><p>###<br>    不同的 deps 字段</p>
<pre><code>NPM 包中的依赖有几种形式的字段：`dependencies`、`devDependencies`、`peerDependencies`。以下简要介绍下各字段的不同含义，以及使用场景。
</code></pre><div style="-ms-overflow-x: auto;"><br>    <table><br>        <thead><br>            <tr><br>                <th><br>                    字段<br>                </th><br>                <th><br>                    含义<br>                </th><br>                <th><br>                    依赖被安装的时机<br>                </th><br>                <th><br>                    使用场景<br>                </th><br>            </tr><br>        </thead><br>        <tbody><br>            <tr><br>                <td><br>                    <code>dependencies</code><br>                </td><br>                <td><br>                    运行时依赖，包的调用者需要使用到的依赖<br>                </td><br>                <td><br>                    执行 <code>npm install</code> 后会把当前包的 <code>dependencies</code> 字段中的所有依赖项安装到 <code>./node_modules</code> 目录。<br><br>                    执行 <code>npm install xxx</code> 后会把 xxx 安装到 <code>./node_modules</code> 下，同时会安装 xxx 的 <code>dependencies</code> 字段依赖项到 <code>./node_modules/xxx/node_modules</code> 目录。<br><br>                    执行 <code>npm install xxx --save</code> 后会额外把 xxx 作为依赖存到当前包的 <code>dependencies</code> 字段中。<br>                </td><br>                <td><br>                    所有程序运行需要用到的依赖代码，如 lodash 等。<br>                </td><br>            </tr><br>            <tr><br>                <td><br>                    <code>devDependencies</code><br>                </td><br>                <td><br>                    开发时依赖，包的开发维护者需要使用到的依赖<br>                </td><br>                <td><br>                    执行 <code>npm install</code> 后也会把当前包的 <code>devDependencies</code> 字段中的所有依赖项安装到 <code>./node_modules</code> 目录。<br><br>                    执行 <code>npm install xxx</code> 后会把 xxx 安装到 <code>./node_modules</code> 下，但不会安装 xxx 的 <code>devDependencies</code> 字段依赖项。<br><br>                    执行 <code>npm install xxx --save-dev</code> 后会额外把 xxx 作为开发时依赖存到当前包的 <code>devDependencies</code> 字段中。<br>                </td><br>                <td><br>                    一般是一些开发调试的辅助工具，如测试工具 mocha、构建工具 gulp 等。<br>                </td><br>            </tr><br>            <tr><br>                <td><br>                    <code>peerDependencies</code><br>                </td><br>                <td><br>                    略<br>                </td><br>                <td><br>                    略<br>                </td><br>                <td><br>                    仅在 <a href="https://nodejs.org/en/blog/npm/peer-dependencies/" target="_blank" rel="noopener"><font color="#0066cc">特定场景</font></a> 下有用，默认不使用此字段。<br>                </td><br>            </tr><br>        </tbody><br>    </table><br></div></div>
    
      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            
          </div>
        </div>
      </div>
    
  
</article>

      <footer class="footer">
  <p class="footer-text"></p>
</footer>

    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
