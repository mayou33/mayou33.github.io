<!doctype html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="undefined">
  <meta name="description" content="互联网技术">
  <meta name="author" content="zhangyu">

  
  <title>Linux 内核优化详解---原创必备</title>
  

  <link rel="canonical" href="http://zhangyu33.com/2017/04/26/976/index.html">
  <link rel="shortcut icon" href="/">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="undefined">
  <link rel="stylesheet" href="/font.css">
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang"></i><a href="/index.html" class="aside-menu-link" title="首页">首页</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang1"></i><a href="/archives/index.html" class="aside-menu-link" title="所有文章">所有文章</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-biaoqian1"></i><a href="/tags/index.html" class="aside-menu-link" title="分类标签">分类标签</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-lianjie"></i><a href="/links/index.html" class="aside-menu-link" title="友情链接">友情链接</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-guanyu"></i><a href="/about/index.html" class="aside-menu-link" title="关于">关于</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
      <form class="search-from" id="search-from">
  <input class="search-text" id="search-text" type="text" name="searchText" value autocomplete="off">
  <button class="search-btn" id="search-btn" type="button"><i class="search-btn-icon iconfont icon-sousuo-sousuo"></i></button>
</form>

      <article class="search-data" id="search-data">
  <button class="search-close" id="search-close"><i class="search-close-icon iconfont icon-houdongfangiconfont10"></i></button>

  <div class="search-wrapper" id="search-wrapper"></div>
</article>

    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.png" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          大雨哥
          
          <strong class="aside-avatar-STRONG">个人博客</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">互联网技术/架构/团队</p>
    </div>
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">Linux 内核优化详解---原创必备</h1>
    <p class="post-meta">
      <span class="post-time">2017-04-26</span>
      
      <a href="/categories/内核/" title="内核" class="post-categories">内核</a>
      
      
      <a href="/tags/内核/" " title="内核" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>内核</a>
      
    </p>
    
  </header>
  <div class="post-content"><p>centos6 </p>
<p> /etc/sysctl.conf </p>
<p>centos7</p>
<p>cat /root/chushihua-centos7.x/sysctl.conf &gt;&gt; /etc/sysctl.d/90-override.conf</p>
<p>sysctl -p /etc/sysctl.d/90-override.conf</p>
<p>或者/usr/lib/sysctl.d/50-default.conf</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br></pre></td><td class="code"><pre><span class="line"># Kernel sysctl configuration file for Red Hat Linux</span><br><span class="line">#</span><br><span class="line"># For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and</span><br><span class="line"># sysctl.conf(5) for more details.</span><br><span class="line"></span><br><span class="line"># Controls IP packet forwarding</span><br><span class="line">## 不充当路由器</span><br><span class="line">#0，表示禁止数据包转发，1表示允许</span><br><span class="line">net.ipv4.ip_forward = 0</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># rp_filter用于实现反向过滤技术</span><br><span class="line">#  0 - No source validation.</span><br><span class="line">#        1 - Strict mode as defined in RFC3704 Strict Reverse Path</span><br><span class="line">#            Each incoming packet is tested against the FIB and if the interface</span><br><span class="line">#            is not the best reverse path the packet check will fail.</span><br><span class="line">#            By default failed packets are discarded.  默认情况下，丢弃失败的数据包。</span><br><span class="line">#RFC3704中定义的严格模式严格反向路径每个传入数据包都针对FIB进行测试，如果接口不是最佳反向路径，则数据包检查将失败。</span><br><span class="line">#        2 - Loose mode as defined in RFC3704 Loose Reverse Path</span><br><span class="line">#            Each incoming packet&apos;s source address is also tested against the FIB</span><br><span class="line">#            and if the source address is not reachable via any interface</span><br><span class="line">#            the packet check will fail.</span><br><span class="line"># RFC3704中定义的松散模式宽松反向路径每个传入数据包的源地址还针对FIB进行测试，如果源地址无法通过任何接口访问，则数据包检查将失败。</span><br><span class="line">#        Current recommended practice in RFC3704 is to enable strict mode</span><br><span class="line"> #       to prevent IP spoofing from DDos attacks. If using asymmetric routing</span><br><span class="line"> #       or other complicated routing, then loose mode is recommended.</span><br><span class="line">#RFC3704中的当前推荐做法是启用严格模式以防止DDoS攻击的IP欺骗。 如果使用非对称路由或其他复杂路由，建议使用松散模式。</span><br><span class="line">#The default value is 0, but note that some distributions enable it in startup scripts.</span><br><span class="line">net.ipv4.conf.all.rp_filter = 2</span><br><span class="line">net.ipv4.conf.default.rp_filter = 2</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># 多网卡接收多播 arp_filter</span><br><span class="line">#0 - (default) The kernel can respond to ARP requests with addresses from other interfaces. This may seem wrong but it usually makes sense, because it increases the chance of successful communication.  IP addresses are owned by the complete host on Linux, not by particular interfaces. Only for more complex setups like load-balancing, does this behaviour cause problems.</span><br><span class="line">#1 - Allows you to have multiple network interfaces on the same subnet, and have the ARPs for each interface be answered based on whether or not the kernel would route a packet from the ARP&apos;d IP out that interface (therefore you must use source based routing for this to work). In other words it allows control of which cards (usually 1) will respond to an ARP request.</span><br><span class="line">#arp_filter for the interface will be enabled if at least one of conf/&#123;all,interface&#125;/arp_filter is set to 1, it will be disabled otherwise.</span><br><span class="line">net.ipv4.conf.all.arp_filter = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line"># Do not accept source routing</span><br><span class="line"># 处理无源路由的包</span><br><span class="line">#Accept packets with SRR option.</span><br><span class="line">#conf/all/accept_source_route must also be set to 1 to accept packets with SRR option on the interface.</span><br><span class="line">#Default: 1 (router), 0 (host).</span><br><span class="line"></span><br><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># Controls the System Request debugging functionality of the kernel</span><br><span class="line">#SysRq 经常被称为 Magic System Request，它被定义为一系列按键组合。之所以说它神奇，是因为它在系统挂起，大多数服务已无法响应的情况下，还能通过按键组合来完成一系列预先定义的系统操作。通过它，不但可以在保证磁盘数据安全的情况下重启一台挂起的服务器，避免数据丢失和重启后长时间的文件系统检查，还可以收集包括系统内存使用，CPU 任务处理，进程运行状态等系统运行信息，甚至还可能在无需重启的情况下挽回一台已经停止响应的服务器。</span><br><span class="line">#0 不启用 SysRq ，1 启用</span><br><span class="line">kernel.sysrq = 0</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># Controls whether core dumps will append the PID to the core filename.</span><br><span class="line"># Useful for debugging multi-threaded applications.</span><br><span class="line">#当系统中的一些程序在遇到一些错误以及crash时，系统会自动产生core file记录crash时刻系统信息包括内存和寄存器信息，用以程序员日后debug时可以使用。这些错误包括断错误，非法指令，总线错误和用户自己生成的退出信号等等。一般的，core file会在当前文件夹中存放。</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># Controls the use of TCP syncookies</span><br><span class="line">#开启SYN洪水攻击保护</span><br><span class="line">#表示开启SYN Cookies。当出现SYN等待队列溢出时，启用cookies来处理，可防范少量SYN攻击，默认为0，表示关闭；</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># Controls the default maxmimum size of a mesage queue</span><br><span class="line">#该文件指定一个消息队列的最大长度（bytes)缺省设置：16384</span><br><span class="line">kernel.msgmnb = 1073741824</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># Controls the maximum size of a message, in bytes</span><br><span class="line">#该文件指定了从一个进程发送到另一个进程的消息的最大长度（bytes）。进程间的消息传递是在内核的内存中进行的，不会交换到磁盘上，所以如果增加该值，则将增加操作系统所使用的内存数量。</span><br><span class="line">kernel.msgmax = 20480000</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"># Controls the maximum shared segment size, in bytes</span><br><span class="line">#该文件表示内核所允许的最大共享内存段的大小（bytes）。</span><br><span class="line">#缺省设置：33554432</span><br><span class="line">#建议设置：物理内存 * 50%</span><br><span class="line">## Oracle-Validated setting for kernel.shmmax is 4398046511104</span><br><span class="line">kernel.shmmax = 4398046511104</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line"># Controls the maximum number of shared memory segments, in pages</span><br><span class="line">#该文件表示在任何给定时刻，系统上可以使用的共享内存的总量（bytes）。</span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line">#该文件指定消息队列标识的最大数目，即系统范围内最大多少个消息队列。缺省设置：16</span><br><span class="line">kernel.msgmni = 4096000</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">#for radis</span><br><span class="line">#该文件指定了内核针对内存分配的策略，其值可以是0、1、2。缺省设置：0</span><br><span class="line">#0， 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。</span><br><span class="line">#1， 表示内核允许分配所有的物理内存，而不管当前的内存状态如何。</span><br><span class="line">#2， 表示内核允许分配超过所有物理内存和交换空间总和的内存（参照overcommit_ratio）。</span><br><span class="line">#vm.overcommit_memory = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">########  with a 10G NIC, optimized for network paths up to 100ms RTT</span><br><span class="line"></span><br><span class="line"># allow testing with buffers up to 64MB</span><br><span class="line">#指定了接收窗口套接字缓冲区大小的最大值，单位是字节。</span><br><span class="line">net.core.rmem_max = 67108864</span><br><span class="line">#指定了发送套接字缓冲区大小的最大值，单位是字节。</span><br><span class="line">net.core.wmem_max = 67108864</span><br><span class="line"></span><br><span class="line">#默认的TCP数据发送窗口大小（字节）。</span><br><span class="line">net.core.wmem_default = 11059200</span><br><span class="line"></span><br><span class="line">#默认的TCP数据接收窗口大小（字节）。</span><br><span class="line">net.core.rmem_default = 11059200</span><br><span class="line">##表示每个套接字所允许的最大缓冲区的大小。缺省设置：10240</span><br><span class="line">net.core.optmem_max= 2048000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#为自动调优定义每个 socket 使用的内存。第一个值是为 socket 的发送缓冲区分配的最少字节数。第二个值是默认值（该值会被 wmem_default 覆盖），缓冲区在系统负载不重的情况下可以增长到这个值。第三个值是发送缓冲区空间的最大字节数（该值会被 wmem_max 覆盖）。</span><br><span class="line"># increase Linux autotuning TCP buffer limit to 32MB</span><br><span class="line">#该文件包含3个整数值，分别是：min，default，max</span><br><span class="line">#Min：为TCP socket预留用于接收/接收缓冲的内存数量，即使在内存出现紧张情况下TCP socket都至少会有这么多数量的内存用于接收缓冲。</span><br><span class="line">#Default：为TCP socket预留用于接收/缓冲的内存数量，默认情况下该值影响其它协议使用的 net.core.wmem中default的 值。该值决定了在tcp_adv_win_scale、tcp_app_win和tcp_app_win的默认值情况下，TCP 窗口大小为65535。</span><br><span class="line">#Max：为TCP socket预留用于接收/缓冲的内存最大值。该值不会影响 net.core.wmem中max的值，</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_wmem = 10240 87380 33554432</span><br><span class="line"></span><br><span class="line">#与 tcp_wmem 类似，不过它表示的是为自动调优所使用的接收缓冲区的值。</span><br><span class="line">net.ipv4.tcp_rmem = 10240 87380 33554432</span><br><span class="line"></span><br><span class="line"># recommended default congestion control is htcp 超文本缓冲 </span><br><span class="line">###### There seem to be bugs in both bic and cubic for a number of versions of the Linux kernel up to version 2.6.33. We recommend using htcp with older kernels to be safe.</span><br><span class="line">#If cubic and/or htcp are not listed try the following, as most distributions include them as loadable kernel modules:</span><br><span class="line">#要加入开机自启</span><br><span class="line">#/sbin/modprobe tcp_htcp</span><br><span class="line">#/sbin/modprobe tcp_cubic</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_congestion_control=htcp</span><br><span class="line"></span><br><span class="line"># recommended for hosts with jumbo frames enabled 开启系统巨型帧</span><br><span class="line">net.ipv4.tcp_mtu_probing=1</span><br><span class="line"></span><br><span class="line"># recommended for CentOS7/Debian8 hosts</span><br><span class="line">#net.core.default_qdisc = fq</span><br><span class="line"></span><br><span class="line">#On CentOS 5/6 hosts, also add this to /etc/rc.local (where N is the number for your 10G NIC): </span><br><span class="line">#On newer CentOS7 this is no longer needed.</span><br><span class="line">#      /sbin/ifconfig ethN txqueuelen 10000</span><br><span class="line">#########################################################</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">##########################TIME_WAIT 相关参数</span><br><span class="line">#控制TIME_WAIT总数-（一般缺省是180000）TIME_WAIT 只在主动关闭的一端出现</span><br><span class="line">#系统在同时所处理的最大timewait sockets 数目。如果超过此数的话，time-wait socket 会被立即砍除并且显示警告信息。</span><br><span class="line">#之所以要设定这个限制，纯#粹为了抵御那些简单的 DoS 攻击，千万不要人为的降低这个限制，</span><br><span class="line">#不过，如果网络条件需要比默认值更多，则可以提高它(或许还要增加内存)。</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 1440000</span><br><span class="line"></span><br><span class="line">#####下面两个参数---如果开启，在NAT环境下会引发问题。 实际的网络情况中 公司家庭网络都走NAT。只能依赖于NAT分享同一个公网IP。</span><br><span class="line">#开启TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭。</span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line"></span><br><span class="line">#tcp_timestamps用来支持RTT的来回时间计算。默认打开的 .</span><br><span class="line"></span><br><span class="line">#tcp_tw_recycle/tcp_timestamps都开启的条件下，60s内同一源ip主机的socket connect请求中的timestamp必须是递增的,导致部分通过NAT上网client无法正确连接服务器，故障表现为client发出SYN后无法收到server返回 的SYN+ACK，推荐的解决方法是关闭</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line"></span><br><span class="line">##复用TIME_WAIT连接---表示是否允许重新应用处于TIME-WAIT状态的socket用于新的TCP连接。</span><br><span class="line">#默认为0，表示关闭。如果使用tcp_tw_reuse，请激活tcp_timestamps，否则无效.</span><br><span class="line">net.ipv4.tcp_tw_reuse = 0</span><br><span class="line"></span><br><span class="line">## 表示如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间.默认值是 60秒</span><br><span class="line">net.ipv4.tcp_fin_timeout = 5</span><br><span class="line"></span><br><span class="line">#################################################</span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">##使用 Selective ACK﹐它可以用来查找特定的遗失的数据报— 因此有助于快速恢复状态。</span><br><span class="line">#表示是否启用有选择的应答（Selective Acknowledgment），这可以通过有选择地应答乱序接收到的报文来提高性能（这样可以让发送者只发送丢失的报文段）。</span><br><span class="line">#(对于广域网通信来说这个选项应该启用，但是这会增加对 CPU 的占用。)</span><br><span class="line">net.ipv4.tcp_sack = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line">###启用转发应答（Forward Acknowledgment），这可以进行有选择应答（SACK）从而减少拥塞情况的发生；这个选项也应该启用。</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_fack = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">###启用 RFC 1323 定义的 window scaling；要支持超过 64KB 的窗口，必须启用该值。</span><br><span class="line">net.ipv4.tcp_window_scaling = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line">#https://cwiki.apache.org/confluence/display/GEODE/Network+Configuration+Best+Practices</span><br><span class="line">#系统所能处理不属于任何进程的TCP sockets最大数量。假如超过这个数量，那么不属于任何进程的连接会被立即reset，并同时显示警告信息。</span><br><span class="line">#之所以要设定这个限制﹐纯粹为了抵御那些简单的 DoS 攻击﹐千万不要依赖这个或是人为的降低这个限制，更应该增加这个值(如果增加了内存之后)。</span><br><span class="line">#每个孤儿套接字最多能够吃掉你64K不可交换的内存。</span><br><span class="line">net.ipv4.tcp_max_orphans = 400000</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">##指定所能接受SYN同步包的最大客户端数量，即半连接上限</span><br><span class="line">#表示SYN队列的长度，默认为1024，加大队列长度 可以容纳更多等待连接的网络连接数。</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 3240000</span><br><span class="line"></span><br><span class="line">##http://www.saunix.cn/1255.html</span><br><span class="line">#服务端所能accept即处理数据的最大客户端数量，即完成连接上限。</span><br><span class="line">#表示socket监听（listen）的backlog上限。什么是backlog呢？backlog就是socket的监听队列，当一个请求（request）尚未被处理或建立时，他会进入backlog。</span><br><span class="line">#tcp_max_syn_backlog用于指定酒席现场面积允许容纳多少人进来；</span><br><span class="line">#somaxconn用于指定有多少个座位。</span><br><span class="line">###tcp_max_syn_backlog &gt;= somaxconn。</span><br><span class="line">net.core.somaxconn = 655350</span><br><span class="line">################################</span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">#对于一个新建连接，内核要发送多少个 SYN 连接请求才决定放弃。不应该大于255，默认值是5，对应于180秒左右时间。</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line"></span><br><span class="line">###表示回应第二个握手包（SYN+ACK包）给客户端IP后，如果收不到第三次握手包（ACK包）后，不进行重试，加快回收“半连接”，不要耗光资源。</span><br><span class="line">#默认为5，表示重发5次，每次等待30~40秒，即“半连接”默认hold住大约180秒。(可以根据上面的 tcp_syn_retries 来决定这个值)</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line"></span><br><span class="line">#####################</span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line">#确定 TCP 栈应该如何反映内存使用；每个值的单位都是内存页（通常是 4KB）。第一个值是内存使用的下限。第二个值是内存压力模式开始对缓冲区使用应用压力的上限。第三个值是内存上限。在这个层次上可以将报文丢弃，从而减少对内存的使用。对于较大的 BDP 可以增大这些值（但是要记住，其单位是内存页，而不是字节）。</span><br><span class="line"></span><br><span class="line">#该文件包含3个整数值，分别是：low，pressure，high</span><br><span class="line">#low：当TCP使用了低于该值的内存页面数时，TCP不会考虑释放内存。(理想情况下，这个值应与指定给 tcp_wmem 的第 2 个值相匹配 - 这第 2 个值表明，最大页面大小乘以最大并发请求数除以页大小 (131072 * 300 / 4096)。 )</span><br><span class="line">#pressure：当TCP使用了超过该值的内存页面数量时，TCP试图稳定其内存使用，进入pressure模式，当内存消耗低于low值时则退出pressure状态。(理想情况下这个值应该是 TCP 可以使用的总缓冲区大小的最大值 (204800 * 300 / 4096)。 )</span><br><span class="line">#high：允许所有tcp sockets用于排队缓冲数据报的页面量。(如果超过这个值，TCP 连接将被拒绝，这就是为什么不要令其过于保守 (512000 * 300 / 4096) 的原因了。 在这种情况下，提供的价值很大，它能处理很多连接，是所预期的 2.5 倍；或者使现有连接能够传输 2.5 倍的数据。 我的网络里为192000 300000 732000)</span><br><span class="line">#一般情况下这些值是在系统启动时根据系统内存数量计算得到的。</span><br><span class="line">#缺省设置：24576 32768 49152</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_mem = 94500000 915000000 927000000</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line"></span><br><span class="line">#######这33个参数与TCP KeepAlive有关</span><br><span class="line">#意思是如果某个TCP连接在idle 10秒后,内核才发起probe.如果probe 3次(每次5秒)不成功,内核才彻底放弃,认为该连接已失效.</span><br><span class="line">net.ipv4.tcp_keepalive_time = 10</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 5</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line">#用于向外连接的端口范围</span><br><span class="line">net.ipv4.ip_local_port_range = 1025 65535</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------</span><br><span class="line">#明确的拥塞通知（英语：Explicit Congestion Notification，简称ECN）</span><br><span class="line">#许多现代产品中的TCP/IP协议已部分支持ECN；但是，大多数产品默认禁用ECN</span><br><span class="line">#0 – 禁用ECN，不发起也不接受</span><br><span class="line">#1 – 启用ECN，当传入连接请求时，并也在传出连接时尝试请求ECN</span><br><span class="line">#2 – （默认）传入连接请求时启用ECN，但不在传出连接上请求ECN</span><br><span class="line">#从2015年6月发布的Linux内核4.1开始，tcp_ecn_fallback机制按RFC 3168中的规定，在ECN被启用（值为1）时默认启用。</span><br><span class="line">#该回退机制在传出连接的初始设置时尝试ECN连接，对没有ECN能力的传输实行良好回退，缓解不支持ECN的主机或防火墙问题。</span><br><span class="line">net.ipv4.tcp_ecn = 0</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线--------------                             </span><br><span class="line">###路由緩存刷新頻率，當一個路由失敗後多長時間跳到另一個路由，默認是300seconds </span><br><span class="line">net.ipv4.route.gc_timeout = 100</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#If you ping the broadcast address of a network, all hosts are supposed to respond. </span><br><span class="line">#抵御 DDoS-- This makes for a dandy denial-of-service tool. Set this to 1 to ignore these broadcast messages.  </span><br><span class="line">#Ignoring &quot;broadcast pings&quot;                   </span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#&quot;bad error messages&quot; protection</span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1    </span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#禁止Ping，默认是允许ping。-This will advise the kernel to drop any ICMP packets of type 0 (zero)</span><br><span class="line">#net.ipv4.icmp_echo_ignore_all = 1</span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#For   CentOS5/6 </span><br><span class="line">##表示在每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。</span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#oracle 12cR1 requisite</span><br><span class="line">#内核所能分配到的最大句柄数</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">#表示设置的信号量，这4个参数内容大小固定。</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">#上面的4个数据分别对应:SEMMSL、SEMMNS、SEMOPM、SEMMNI这四个核心参数，具体含义和配置如下。</span><br><span class="line">#SEMMSL ：用于控制每个信号集的最大信号数量。</span><br><span class="line">#          Oracle 建议将 SEMMSL 设置为 init.ora 文件（用于 Linux 系统中的所有数据库）中的最大 PROCESS 实例参数的设置值再加上 10 。此外， Oracle 建议将 SEMMSL 的值设置为不少于 100 。</span><br><span class="line">#SEMMNS：用于控制整个 Linux 系统中信号（而不是信号集）的最大数。</span><br><span class="line">#       Oracle 建议将 SEMMNS 设置为：系统中每个数据库的 PROCESSES 实例参数设置值的总和，加上最大 PROCESSES 值的两倍，最后根据系统中 Oracle 数据库的数量，每个加 10 。 使用以下计算式来确定在 Linux 系统中可以分配的信号的最大数量。它将是以下两者中较小的一个值：SEMMNS 或 (SEMMSL * SEMMNI)</span><br><span class="line">#SEMOPM： 内核参数用于控制每个 semop 系统调用可以执行的信号操作的数量。semop 系统调用（函数）提供了利用一个 semop 系统调用完成多项信号操作的功能。一个信号集能够拥有每个信号集中最大数量的SEMMSL 信号，因此建议设置 SEMOPM 等于SEMMSL 。</span><br><span class="line">#        Oracle 建议将 SEMOPM 的值设置为不少于 100 。</span><br><span class="line">#SEMMNI ：内核参数用于控制整个 Linux 系统中信号集的最大数量。</span><br><span class="line">#         Oracle 建议将 SEMMNI 的值设置为不少于 100</span><br><span class="line"></span><br><span class="line">#内核异步 I/O (KAIO) 请求 最大数量 </span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#关闭ipv6</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">##该文件表示脏数据到达系统整体内存的百分比，此时触发pdflush进程把脏数据写回磁盘。缺省设置：0，禁用Block Debug模式</span><br><span class="line">vm.dirty_background_ratio = 5</span><br><span class="line"></span><br><span class="line">#该文件表示如果进程产生的脏数据到达系统整体内存的百分比，此时进程自行把脏数据写回磁盘。</span><br><span class="line">vm.dirty_ratio = 10</span><br><span class="line"></span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">#This file contains the maximum number of memory map areas a process may have. Memory map areas are used as a side-effect of calling malloc, directly by mmap and mprotect, and also when loading shared libraries.</span><br><span class="line">#While most applications need less than a thousand maps, certain programs, particularly malloc debuggers, may consume lots of them, e.g., up to one or two maps per allocation.</span><br><span class="line">#The default value is 65536.</span><br><span class="line">#max_map_count这个参数就是允许一个进程在VMAs(虚拟内存区域)拥有最大数量，VMA是一个连续的虚拟地址空间，当进程创建一个内存映像文件时VMA的地址空间就会增加，当达到max_map_count了就是返回out of memory errors。</span><br><span class="line">vm.max_map_count = 1048575</span><br><span class="line">#-------------------华丽的分割线-------------- </span><br><span class="line">##TCP Fast Open（TFO）——一种对TCP协议的扩展，允许在TCP握手期间的TCP-SYN 和TCP-SYN/ACK数据包中夹带数据，这样就减少了一个RTT。</span><br><span class="line">#内核最好升级4.x版本</span><br><span class="line">net.ipv4.tcp_fastopen = 3</span><br></pre></td></tr></table></figure></div>
    
      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            
          </div>
        </div>
      </div>
    
  
</article>

      <footer class="footer">
  <p class="footer-text"></p>
</footer>

    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
