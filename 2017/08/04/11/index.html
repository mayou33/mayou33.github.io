<!doctype html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="undefined">
  <meta name="description" content="互联网技术">
  <meta name="author" content="zhangyu">

  
  <title>nginx 安装方式</title>
  

  <link rel="canonical" href="http://zhangyu233.com/2017/08/04/11/index.html">
  <link rel="shortcut icon" href="/">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="undefined">
  <link rel="stylesheet" href="/font.css">
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang"></i><a href="/index.html" class="aside-menu-link" title="首页">首页</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang1"></i><a href="/archives/index.html" class="aside-menu-link" title="所有文章">所有文章</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-biaoqian1"></i><a href="/tags/index.html" class="aside-menu-link" title="分类标签">分类标签</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-lianjie"></i><a href="/links/index.html" class="aside-menu-link" title="友情链接">友情链接</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-guanyu"></i><a href="/about/index.html" class="aside-menu-link" title="关于">关于</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
      <form class="search-from" id="search-from">
  <input class="search-text" id="search-text" type="text" name="searchText" value="" autocomplete="off">
  <button class="search-btn" id="search-btn" type="button"><i class="search-btn-icon iconfont icon-sousuo-sousuo"></i></button>
</form>

      <article class="search-data" id="search-data">
  <button class="search-close" id="search-close"><i class="search-close-icon iconfont icon-houdongfangiconfont10"></i></button>

  <div class="search-wrapper" id="search-wrapper"></div>
</article>

    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.png" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          大雨哥
          
          <strong class="aside-avatar-STRONG">个人博客</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">互联网技术/架构/团队</p>
    </div>
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">nginx 安装方式</h1>
    <p class="post-meta">
      <span class="post-time">2017-08-04</span>
      
      <a href="/categories/nginx/" title="nginx" class="post-categories">nginx</a>
      
      
      <a href="/tags/nginx/"" title="nginx" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>nginx</a>
      
    </p>
    
  </header>
  <div class="post-content"><p>nginx默认是对客户端使用长连接，对服务器使用短连接。</p>
<p>centos7操作系统要事先优化。</p>
<p>Nginx官网提供了三个类型的版本</p>
<p>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版</p>
<p>Stable version：最新稳定版，生产环境上建议使用的版本</p>
<p>Legacy versions：遗留的老版本的稳定版</p>
<p>#####简单用—屌丝青年</p>
<p>nginx下载安装<br><a href="http://nginx.org/packages/centos/7/x86_64/RPMS/" target="_blank" rel="external">http://nginx.org/packages/centos/7/x86_64/RPMS/</a></p>
<p>rpm -vh <a href="http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.12.1-1.el7.ngx.x86_64.rpm" target="_blank" rel="external">http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.12.1-1.el7.ngx.x86_64.rpm</a></p>
<p>#########系统版 —普通青年</p>
<p>yum -y install yum-priorities epel-release </p>
<p>yum -y install nginx</p>
<p>The default server root directory is /usr/share/nginx/html</p>
<p>#########官方版—-文艺青年</p>
<p>Stable version 最新稳定版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cat &gt;&gt; /etc/yum.repos.d/nginx-Stable.repo &lt;&lt;EOF</div><div class="line">[nginx]</div><div class="line">name=nginx Stable repo</div><div class="line">baseurl=http://nginx.org/packages/centos/7/\$basearch/</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div><div class="line">EOF</div><div class="line"></div><div class="line">或者rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</div></pre></td></tr></table></figure></p>
<p>Mainline version 开发版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cat &gt;&gt;/etc/yum.repos.d/nginx-Mainline.repo &lt;&lt;EOF</div><div class="line">[nginx]</div><div class="line">name=nginx Mainline repo</div><div class="line">baseurl=http://nginx.org/packages/mainline/centos/7/\$basearch/</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div><div class="line">EOF</div><div class="line">#####</div><div class="line">~~~</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rpm --import https://nginx.org/keys/nginx_signing.key</div><div class="line"></div><div class="line">yum -y install nginx</div></pre></td></tr></table></figure>
<p>########源码安装—专业青年<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">yum install –y gcc gcc-c++ autoconf automake wget unzip zlib zlib-devel pcre pcre-devel openssl openssl-devel  libxml2 libxml2-devel  libxslt   libxslt-devel gd-devel perl-devel perl-ExtUtils-Embed</div><div class="line"></div><div class="line">groupadd nginx</div><div class="line">useradd -M -s /sbin/nologin nginx  -g nginx</div><div class="line">mkdir -p /data/logs/nginx</div><div class="line">chown -R nginx.nginx /data/logs/nginx</div><div class="line">mkdir -p  /opt/nginx/conf/conf.d/</div><div class="line"> mkdir -p /var/cache/nginx/</div><div class="line">chown -R nginx.nginx /var/cache/nginx/</div><div class="line">路径约定/opt</div><div class="line">wget https://nginx.org/download/nginx-1.12.1.tar.gz</div><div class="line">tar zxvf /opt/nginx-1.12.1.tar.gz </div><div class="line">cd /opt/nginx-1.12.1</div></pre></td></tr></table></figure></p>
<p>(默认没有带第三方模块)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">./configure \</div><div class="line">  --prefix=/opt/nginx \</div><div class="line">  --with-http_ssl_module \</div><div class="line">  --with-http_v2_module \</div><div class="line">  --with-cc-opt=-DTCP_FASTOPEN=23 \</div><div class="line">  --with-pcre \</div><div class="line">  --with-compat\</div><div class="line">  --user=nginx\</div><div class="line">  --group=nginx\</div><div class="line">  --with-file-aio\</div><div class="line">  --http-client-body-temp-path=/var/cache/nginx/client_temp \</div><div class="line">  --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</div><div class="line">  --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</div><div class="line">  --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</div><div class="line">  --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</div><div class="line">  --with-http_addition_module\</div><div class="line">  --with-http_sub_module\</div><div class="line">  --with-http_dav_module\</div><div class="line">  --with-http_mp4_module\</div><div class="line">  --with-http_gunzip_module\</div><div class="line">  --with-http_gzip_static_module\</div><div class="line">  --with-http_random_index_module \</div><div class="line">  --with-http_stub_status_module\</div><div class="line">  --with-http_auth_request_module \</div><div class="line">  --with-http_slice_module \</div><div class="line">  --with-http_realip_module \</div><div class="line">  --with-http_secure_link_module \</div><div class="line">  --with-stream \</div><div class="line">  --with-stream_ssl_module \</div><div class="line">  --with-stream_realip_module \</div><div class="line">  --with-stream_ssl_preread_module \</div><div class="line">  --with-threads \</div><div class="line">  --with-http_xslt_module=dynamic \</div><div class="line">  --with-http_image_filter_module=dynamic \</div><div class="line">  --with-http_perl_module=dynamic\</div><div class="line">  --with-cc-opt=&apos;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&apos; \</div><div class="line">  --with-ld-opt=&apos;-Wl,-z,relro -Wl,-z,now -pie&apos;</div><div class="line"></div><div class="line"></div><div class="line">make</div><div class="line">make install</div><div class="line"></div><div class="line">chown -R nginx.nginx  /data/logs/nginx</div><div class="line">chown -R nginx.nginx  /opt/nginx/</div><div class="line">echo &apos;/opt/nginx/sbin/nginx &apos; &gt;&gt; /etc/rc.d/rc.local</div></pre></td></tr></table></figure></p>
<p>优化/opt/nginx/conf/nginx.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line">user  nginx;</div><div class="line">worker_processes auto;</div><div class="line">error_log  /data/logs/nginx/error.log  warn;</div><div class="line">pid        logs/nginx.pid;</div><div class="line">worker_rlimit_nofile 655350;</div><div class="line"></div><div class="line">events &#123;</div><div class="line">   accept_mutex off; </div><div class="line">   multi_accept on;</div><div class="line">   use epoll;</div><div class="line">   worker_connections  655350;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    charset  utf-8;</div><div class="line"> </div><div class="line">    log_format  main    &apos;$time_iso8601 - $status - $bytes_sent - $request_time - $http_x_forwarded_for - $remote_addr - $server_addr - $upstream_addr - &apos;</div><div class="line">               &apos;$request_method - $scheme://$host$uri?$query_string - $server_protocol - $ssl_protocol - $http_referer - $http_user_agent - $gzip_ratio - $http_cookie &apos;;</div><div class="line"></div><div class="line"> log_format  json                     </div><div class="line">&apos;&#123;</div><div class="line">    time_iso8601: $time_iso8601</div><div class="line">    status: $status</div><div class="line">    bytes_sent: $bytes_sent</div><div class="line">    http_host: $http_host</div><div class="line">    request_time: $request_time</div><div class="line">    http_x_forwarded_for: $http_x_forwarded_for</div><div class="line">    remote_addr: $remote_addr</div><div class="line">    server_addr: $server_addr</div><div class="line">    upstream_addr: $upstream_addr</div><div class="line">    request_method: $request_method</div><div class="line">    scheme: $scheme</div><div class="line">    host: $host</div><div class="line">    uri: $uri</div><div class="line">    query_string: ?$query_string</div><div class="line">    server_protocol: $server_protocol</div><div class="line">    ssl_protocol: $ssl_protocol</div><div class="line">    ssl_cipher: $ssl_cipher</div><div class="line">    http_referer: $http_referer</div><div class="line">    http_user_agent: $http_user_agent</div><div class="line">    gzip_ratio: $gzip_ratio</div><div class="line">    http_cookie: $http_cookie</div><div class="line">&#125;&apos;;  </div><div class="line"></div><div class="line">    access_log  /data/logs/nginx/access.log  main;</div><div class="line">    server_names_hash_bucket_size 256;</div><div class="line">    client_header_buffer_size 256k;   </div><div class="line">    large_client_header_buffers 4 256k;</div><div class="line">    client_max_body_size          500m;</div><div class="line">    client_header_timeout         3m;</div><div class="line">    client_body_timeout           3m;</div><div class="line">    send_timeout                  3m;</div><div class="line">    sendfile                      on;</div><div class="line">    tcp_nopush                    on;</div><div class="line">    keepalive_timeout             60;</div><div class="line">    tcp_nodelay                   on;</div><div class="line">    server_tokens                 off;</div><div class="line">    </div><div class="line">    limit_conn_zone $binary_remote_addr zone=perip:100m;</div><div class="line">    limit_conn_zone $server_name zone=perserver:100m;</div><div class="line"></div><div class="line">    gzip on;</div><div class="line">    gzip_min_length   1k;</div><div class="line">    gzip_comp_level   4;</div><div class="line">    gzip_buffers 4 16k;</div><div class="line">    gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript application/json application/x-json;</div><div class="line">    gzip_http_version 1.1;</div><div class="line">    gzip_vary    off;</div><div class="line">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</div><div class="line"></div><div class="line">    fastcgi_buffers 32 8k;</div><div class="line">    fastcgi_buffer_size  8K;</div><div class="line">    </div><div class="line">##### enable websocket ######</div><div class="line">    map $http_upgrade $connection_upgrade &#123;</div><div class="line">         default upgrade;</div><div class="line">         &apos;&apos;      close;</div><div class="line">     &#125;</div><div class="line">  </div><div class="line">###  for server_name</div><div class="line">    include /opt/nginx/conf/conf.d/*.conf;</div><div class="line">     </div><div class="line">&#125;</div><div class="line"></div><div class="line">~</div></pre></td></tr></table></figure></p>
<p>启动nginx</p>
<p>/opt/nginx/sbin/nginx </p>
<p>查看安装配置</p>
<p>/opt/nginx/sbin/nginx -V</p>
</div>
    
      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            
          </div>
        </div>
      </div>
    
  
</article>

      <footer class="footer">
  <p class="footer-text"></p>
</footer>

    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
