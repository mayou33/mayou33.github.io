<!doctype html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="undefined">
  <meta name="description" content="互联网技术">
  <meta name="author" content="zhangyu">

  
  <title>nginx 安装方式</title>
  

  <link rel="canonical" href="http://zhangyu8.me/2017/08/04/11/index.html">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="undefined">
  <link rel="stylesheet" href="/font.css">
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang"></i><a href="/index.html" class="aside-menu-link" title="首页">首页</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang1"></i><a href="/archives/index.html" class="aside-menu-link" title="所有文章">所有文章</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-biaoqian1"></i><a href="/tags/index.html" class="aside-menu-link" title="分类标签">分类标签</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-lianjie"></i><a href="/links/index.html" class="aside-menu-link" title="友情链接">友情链接</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-guanyu"></i><a href="/about/index.html" class="aside-menu-link" title="关于">关于</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.png" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          大雨哥
          
          <strong class="aside-avatar-STRONG">个人博客</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">互联网技术/架构/团队</p>
    </div>
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">nginx 安装方式</h1>
    <p class="post-meta">
      <span class="post-time">2017-08-04</span>
      
      <a href="/categories/nginx/" title="nginx" class="post-categories">nginx</a>
      
      
      <a href="/tags/nginx/" " title="nginx" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>nginx</a>
      
    </p>
    
  </header>
  <div class="post-content"><p>nginx默认是对客户端使用长连接，对服务器使用短连接。</p>
<p>centos7操作系统要事先优化。</p>
<p>Nginx官网提供了三个类型的版本</p>
<p>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版</p>
<p>Stable version：最新稳定版，生产环境上建议使用的版本</p>
<p>Legacy versions：遗留的老版本的稳定版</p>
<p>#####简单用—屌丝青年</p>
<p>nginx下载安装<br><a href="http://nginx.org/packages/centos/7/x86_64/RPMS/" target="_blank" rel="noopener">http://nginx.org/packages/centos/7/x86_64/RPMS/</a></p>
<p>rpm -vh <a href="http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.12.1-1.el7.ngx.x86_64.rpm" target="_blank" rel="noopener">http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.12.1-1.el7.ngx.x86_64.rpm</a></p>
<p>#########系统版 —普通青年</p>
<p>yum -y install yum-priorities epel-release </p>
<p>yum -y install nginx</p>
<p>The default server root directory is /usr/share/nginx/html</p>
<p>#########官方版—-文艺青年</p>
<p>Stable version 最新稳定版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/yum.repos.d/nginx-Stable.repo &lt;&lt;EOF</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx Stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/\$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">或者rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<p>Mainline version 开发版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt;/etc/yum.repos.d/nginx-Mainline.repo &lt;&lt;EOF</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx Mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/7/\$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br><span class="line">#####</span><br><span class="line">~~~</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://nginx.org/keys/nginx_signing.key</span><br><span class="line"></span><br><span class="line">yum -y install nginx</span><br></pre></td></tr></table></figure>
<p>########源码安装—专业青年<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install –y gcc gcc-c++ autoconf automake wget unzip zlib zlib-devel pcre pcre-devel openssl openssl-devel  libxml2 libxml2-devel  libxslt   libxslt-devel gd-devel perl-devel perl-ExtUtils-Embed</span><br><span class="line"></span><br><span class="line">groupadd nginx</span><br><span class="line">useradd -M -s /sbin/nologin nginx  -g nginx</span><br><span class="line">mkdir -p /data/logs/nginx</span><br><span class="line">chown -R nginx.nginx /data/logs/nginx</span><br><span class="line">mkdir -p  /opt/nginx/conf/conf.d/</span><br><span class="line"> mkdir -p /var/cache/nginx/</span><br><span class="line">chown -R nginx.nginx /var/cache/nginx/</span><br><span class="line">路径约定/opt</span><br><span class="line">wget https://nginx.org/download/nginx-1.12.1.tar.gz</span><br><span class="line">tar zxvf /opt/nginx-1.12.1.tar.gz </span><br><span class="line">cd /opt/nginx-1.12.1</span><br></pre></td></tr></table></figure></p>
<p>(默认没有带第三方模块)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">./configure \</span><br><span class="line">  --prefix=/opt/nginx \</span><br><span class="line">  --with-http_ssl_module \</span><br><span class="line">  --with-http_v2_module \</span><br><span class="line">  --with-cc-opt=-DTCP_FASTOPEN=23 \</span><br><span class="line">  --with-pcre \</span><br><span class="line">  --with-compat\</span><br><span class="line">  --user=nginx\</span><br><span class="line">  --group=nginx\</span><br><span class="line">  --with-file-aio\</span><br><span class="line">  --http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">  --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">  --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">  --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">  --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">  --with-http_addition_module\</span><br><span class="line">  --with-http_sub_module\</span><br><span class="line">  --with-http_dav_module\</span><br><span class="line">  --with-http_mp4_module\</span><br><span class="line">  --with-http_gunzip_module\</span><br><span class="line">  --with-http_gzip_static_module\</span><br><span class="line">  --with-http_random_index_module \</span><br><span class="line">  --with-http_stub_status_module\</span><br><span class="line">  --with-http_auth_request_module \</span><br><span class="line">  --with-http_slice_module \</span><br><span class="line">  --with-http_realip_module \</span><br><span class="line">  --with-http_secure_link_module \</span><br><span class="line">  --with-stream \</span><br><span class="line">  --with-stream_ssl_module \</span><br><span class="line">  --with-stream_realip_module \</span><br><span class="line">  --with-stream_ssl_preread_module \</span><br><span class="line">  --with-threads \</span><br><span class="line">  --with-http_xslt_module=dynamic \</span><br><span class="line">  --with-http_image_filter_module=dynamic \</span><br><span class="line">  --with-http_perl_module=dynamic\</span><br><span class="line">  --with-cc-opt=&apos;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&apos; \</span><br><span class="line">  --with-ld-opt=&apos;-Wl,-z,relro -Wl,-z,now -pie&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">chown -R nginx.nginx  /data/logs/nginx</span><br><span class="line">chown -R nginx.nginx  /opt/nginx/</span><br><span class="line">echo &apos;/opt/nginx/sbin/nginx &apos; &gt;&gt; /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure></p>
<p>优化/opt/nginx/conf/nginx.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log  /data/logs/nginx/error.log  warn;</span><br><span class="line">pid        logs/nginx.pid;</span><br><span class="line">worker_rlimit_nofile 655350;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">   accept_mutex off; </span><br><span class="line">   multi_accept on;</span><br><span class="line">   use epoll;</span><br><span class="line">   worker_connections  655350;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    charset  utf-8;</span><br><span class="line"> </span><br><span class="line">    log_format  main    &apos;$time_iso8601 - $status - $bytes_sent - $request_time - $http_x_forwarded_for - $remote_addr - $server_addr - $upstream_addr - &apos;</span><br><span class="line">               &apos;$request_method - $scheme://$host$uri?$query_string - $server_protocol - $ssl_protocol - $http_referer - $http_user_agent - $gzip_ratio - $http_cookie &apos;;</span><br><span class="line"></span><br><span class="line"> log_format  json                     </span><br><span class="line">&apos;&#123;</span><br><span class="line">    time_iso8601: $time_iso8601</span><br><span class="line">    status: $status</span><br><span class="line">    bytes_sent: $bytes_sent</span><br><span class="line">    http_host: $http_host</span><br><span class="line">    request_time: $request_time</span><br><span class="line">    http_x_forwarded_for: $http_x_forwarded_for</span><br><span class="line">    remote_addr: $remote_addr</span><br><span class="line">    server_addr: $server_addr</span><br><span class="line">    upstream_addr: $upstream_addr</span><br><span class="line">    request_method: $request_method</span><br><span class="line">    scheme: $scheme</span><br><span class="line">    host: $host</span><br><span class="line">    uri: $uri</span><br><span class="line">    query_string: ?$query_string</span><br><span class="line">    server_protocol: $server_protocol</span><br><span class="line">    ssl_protocol: $ssl_protocol</span><br><span class="line">    ssl_cipher: $ssl_cipher</span><br><span class="line">    http_referer: $http_referer</span><br><span class="line">    http_user_agent: $http_user_agent</span><br><span class="line">    gzip_ratio: $gzip_ratio</span><br><span class="line">    http_cookie: $http_cookie</span><br><span class="line">&#125;&apos;;  </span><br><span class="line"></span><br><span class="line">    access_log  /data/logs/nginx/access.log  main;</span><br><span class="line">    server_names_hash_bucket_size 256;</span><br><span class="line">    client_header_buffer_size 256k;   </span><br><span class="line">    large_client_header_buffers 4 256k;</span><br><span class="line">    client_max_body_size          500m;</span><br><span class="line">    client_header_timeout         3m;</span><br><span class="line">    client_body_timeout           3m;</span><br><span class="line">    send_timeout                  3m;</span><br><span class="line">    sendfile                      on;</span><br><span class="line">    tcp_nopush                    on;</span><br><span class="line">    keepalive_timeout             60;</span><br><span class="line">    tcp_nodelay                   on;</span><br><span class="line">    server_tokens                 off;</span><br><span class="line">    </span><br><span class="line">    limit_conn_zone $binary_remote_addr zone=perip:100m;</span><br><span class="line">    limit_conn_zone $server_name zone=perserver:100m;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length   1k;</span><br><span class="line">    gzip_comp_level   4;</span><br><span class="line">    gzip_buffers 4 16k;</span><br><span class="line">    gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript application/json application/x-json;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_vary    off;</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br><span class="line"></span><br><span class="line">    fastcgi_buffers 32 8k;</span><br><span class="line">    fastcgi_buffer_size  8K;</span><br><span class="line">    </span><br><span class="line">##### enable websocket ######</span><br><span class="line">    map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">         default upgrade;</span><br><span class="line">         &apos;&apos;      close;</span><br><span class="line">     &#125;</span><br><span class="line">  </span><br><span class="line">###  for server_name</span><br><span class="line">    include /opt/nginx/conf/conf.d/*.conf;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~</span><br></pre></td></tr></table></figure></p>
<p>启动nginx</p>
<p>/opt/nginx/sbin/nginx </p>
<p>查看安装配置</p>
<p>/opt/nginx/sbin/nginx -V</p>
</div>
    
      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            
          </div>
        </div>
      </div>
    
  
</article>

      <footer class="footer">
  <p class="footer-text"></p>
</footer>

    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
